# Zuul路由管理实践

我们已经很清楚，Zuul网关有路由的功能，那么一个请求进入网关，它是如何理由到后端的微服务中的呢

## Eureka的自发现

有一种方式是基于Eureka的自发现功能。Eureka其实是一种注册中心，其他的注册中心也是可以完成这个功能的。

后端微服务加入集群（上线）之后，会自己注册到Eureka。

因此整个Eureka可以获取整个微服务集群中，服务的名称和服务所在节点的地址和端口。

而且，Eureka也提供了接口，用来查询注册的服务列表。

<img src="https://oscimg.oschina.net/oscnet/up-2d23d4f82a5368c2256bd73302e6d4264d4.png" width=700 height=310>

当有客户端请求进入到网关中，网关会从请求的路径中获取service name

然后根据service name , 调用eureka接口，查询对应的服务列表。

最后根据某种策略，比如轮训，将请求路由到服务列表中的某个服务节点上面。

比如Ribbon，它是用来做客户端负载均衡的，默认均衡策略是轮训，还有其他的一些策略，比如权重等


## 基于域名的路由策略

- 内部的服务由运维人员统一管理，那个域名解析到那台机器上面
- 内部有一个自研的服务治理中心，维护者一个服务列表，大致包含的信息有：域名，服务名，环境，网关归属等
- 运维人员通过服务治理中心页面手动管理微服务列表，同时服务治理中心也提供接口可以查询服务列表
- 网关可以定时去拉去服务列表数据，比如移动网关，可以获取网关归属是移动端的所有的服务的列表
- 当请求进入到网关的时候，需要借助DNS服务，对域名进行解析，然后把请求路由到对应的服务节点

<img src="https://oscimg.oschina.net/oscnet/up-f3e882fcc6bc96d80d1e356b3b02a736321.png" width=800 height=400>


## 基于集中配置中心的方式


<img src="https://oscimg.oschina.net/oscnet/up-6e4aea40cd7739bd5bea2ed53a6d2b18ec0.png" width=700 height=305>

路由表以某种格式，存放在apollo配置中心，由Zuul的配置客户端**archaius**定时拉取apollo中的数据。

zuul添加一个专门的过滤器，用来解析路由表。

解析的路由表缓存在本地，当客户端请求进入网关之后，直接根据缓存的路由表信息，进行转发；

